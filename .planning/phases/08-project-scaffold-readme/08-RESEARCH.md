# Phase 8: Project Scaffold & README - Research

**Researched:** 2026-01-31
**Domain:** Python project scaffolding with uv, dev tooling (ruff/mypy/pytest/pre-commit), repo README
**Confidence:** HIGH

## Summary

This phase scaffolds a Python sub-project at `rag-ingestion/` inside a mono-repo that already contains a Docusaurus docs site at the root. The standard approach uses `uv` (Astral's Python project manager) with `--lib` mode to create a `src`-layout package, then layers on ruff (lint+format), mypy (type checking), pytest (testing), and pre-commit hooks. The repo README is a straightforward replacement of the existing Docusaurus boilerplate.

The key architectural decision is that `rag-ingestion/` is a self-contained Python project (its own `pyproject.toml`, `.venv`, `uv.lock`) that does NOT form a uv workspace with the repo root. This avoids any interaction between the Node.js/Docusaurus tooling and the Python tooling. All uv commands run from within `rag-ingestion/`.

**Primary recommendation:** Use `uv init --lib --name bbj-rag` inside the `rag-ingestion/` directory to scaffold the src-layout package, then manually configure dev dependency groups, tool settings in pyproject.toml, and supporting files (Makefile, .pre-commit-config.yaml). Pin dev tool versions in dependency groups but leave core pipeline deps (pydantic, psycopg, etc.) for later phases to add.

## Standard Stack

### Core

| Tool | Version | Purpose | Why Standard |
|------|---------|---------|--------------|
| uv | 0.9.28 | Python package/project manager | Replaces pip, poetry, pyenv; extremely fast; from Astral |
| ruff | 0.14.14 | Linting + formatting | Replaces flake8, isort, black; single tool, millisecond speed |
| mypy | 1.19.1 | Static type checking | Industry standard Python type checker |
| pytest | 9.0.2+ | Test framework | De facto standard Python testing |
| pre-commit | 4.3.0 | Git hook management | Standard hook framework, auto-runs checks on commit |

### Supporting

| Tool | Version | Purpose | When to Use |
|------|---------|---------|-------------|
| uv_build | >=0.9.28,<0.10.0 | Build backend for uv | Generated by `uv init --lib`; required for src-layout packages |
| pre-commit-hooks | latest | Basic file checks | trailing-whitespace, end-of-file-fixer, check-yaml |
| ruff-pre-commit | v0.14.14 | Ruff pre-commit hooks | Official Astral-maintained ruff hooks for pre-commit |
| uv-pre-commit | 0.9.28 | uv lock file sync hook | Ensures uv.lock stays in sync with pyproject.toml |

### Future Dependencies (NOT scaffolded now, added in later phases)

| Library | Latest Version | Purpose | Phase Added |
|---------|---------------|---------|-------------|
| pydantic | 2.13.3 | Data models/validation | Phase 9 (models) |
| psycopg | 3.3.2 | PostgreSQL adapter | Phase 11 (database) |
| sentence-transformers | 5.2.2 | Embeddings | Phase 11 (embeddings) |
| lxml | 6.0.1 | XML parsing (Flare XHTML) | Phase 9 (parsers) |
| beautifulsoup4 | 4.14.3 | HTML parsing (crawl) | Phase 10 (crawl) |

**Installation (scaffolding commands):**
```bash
# Create the directory
mkdir rag-ingestion && cd rag-ingestion

# Initialize as library package with bbj-rag name
uv init --lib --name bbj-rag

# Add dev dependencies
uv add --dev pytest ruff mypy pre-commit

# Install pre-commit hooks
uv run pre-commit install
```

## Architecture Patterns

### Recommended Project Structure

```
rag-ingestion/
├── .python-version          # Created by uv init (3.12)
├── .pre-commit-config.yaml  # Pre-commit hook configuration
├── .venv/                   # Created by uv sync (gitignored automatically by uv)
├── Makefile                 # Developer task runner
├── README.md                # Sub-project README (pipeline docs, deferred or minimal)
├── pyproject.toml           # Project metadata + all tool config
├── uv.lock                  # Pinned dependency lockfile (COMMIT THIS)
├── src/
│   └── bbj_rag/
│       ├── __init__.py      # Package root (version, description)
│       ├── py.typed         # PEP 561 marker for mypy
│       ├── parsers/         # Phase 9: Flare XHTML + crawl parsers
│       │   └── __init__.py
│       ├── models/          # Phase 9: Pydantic data models
│       │   └── __init__.py
│       └── pipeline/        # Phase 12: Orchestration pipeline
│           └── __init__.py
└── tests/
    ├── __init__.py
    └── test_placeholder.py  # Minimal test to verify pytest works
```

### Pattern 1: uv init --lib Generates Src Layout

**What:** `uv init --lib --name bbj-rag` creates a src-layout package with `py.typed` marker and `uv_build` backend.

**When to use:** Always for library/importable packages. The src layout prevents accidental imports from the working directory instead of the installed package.

**Generated pyproject.toml:**
```toml
[project]
name = "bbj-rag"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.12"
dependencies = []

[build-system]
requires = ["uv_build>=0.9.28,<0.10.0"]
build-backend = "uv_build"
```

**Important:** uv normalizes the name to `bbj-rag` (hyphens) in pyproject.toml per PEP 503, but the module directory is `src/bbj_rag/` (underscores). Imports work as `from bbj_rag.parsers import ...`. This is standard Python packaging behavior.

### Pattern 2: All Tool Config in pyproject.toml

**What:** ruff, mypy, and pytest are all configured via `[tool.*]` sections in pyproject.toml. No separate config files needed.

**When to use:** Always. Single source of truth for project configuration.

**Example (complete tool configuration):**
```toml
[tool.ruff]
target-version = "py312"
line-length = 88
src = ["src", "tests"]

[tool.ruff.lint]
select = [
    "E",     # pycodestyle errors
    "W",     # pycodestyle warnings
    "F",     # pyflakes
    "I",     # isort
    "B",     # flake8-bugbear
    "UP",    # pyupgrade
    "RUF",   # ruff-specific rules
]
fixable = ["ALL"]

[tool.ruff.format]
quote-style = "double"
indent-style = "space"

[tool.mypy]
python_version = "3.12"
strict = true
warn_return_any = true
warn_unused_configs = true

[[tool.mypy.overrides]]
module = "tests.*"
disallow_untyped_defs = false

[tool.pytest.ini_options]
testpaths = ["tests"]
addopts = ["-ra", "-q"]
```

### Pattern 3: Dependency Groups for Dev Tools

**What:** Use `[dependency-groups]` (PEP 735) instead of `project.optional-dependencies` for dev-only tools.

**When to use:** Always for dev dependencies that should never be shipped.

**Example:**
```toml
[dependency-groups]
dev = [
    "pytest>=9.0.2",
    "ruff>=0.14.14",
    "mypy>=1.19.1",
    "pre-commit>=4.3.0",
]
```

**Note:** `uv add --dev` automatically populates this section. The `dev` group syncs by default with `uv sync`.

### Pattern 4: Local Pre-commit Hook for mypy

**What:** Use a local system hook (`language: system`) with `uv run mypy` instead of the `mirrors-mypy` repo.

**When to use:** Always when using uv. The mirrors-mypy approach runs mypy in an isolated virtualenv that lacks your project's dependencies, causing false-positive import errors.

**Example (.pre-commit-config.yaml):**
```yaml
repos:
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.14
    hooks:
      - id: ruff-check
        args: [--fix]
      - id: ruff-format

  - repo: local
    hooks:
      - id: mypy
        name: mypy
        entry: uv run mypy src/
        language: system
        types: [python]
        pass_filenames: false
```

### Pattern 5: Makefile as Task Runner

**What:** Thin Makefile wrapping `uv run` commands for common dev tasks.

**When to use:** Always. Provides discoverable, short commands.

**Example:**
```makefile
.PHONY: sync test lint format typecheck check clean

sync:
	uv sync

test:
	uv run pytest

lint:
	uv run ruff check src/ tests/

format:
	uv run ruff format src/ tests/

typecheck:
	uv run mypy src/

check: lint typecheck test

clean:
	rm -rf .mypy_cache .ruff_cache .pytest_cache
	find . -type d -name __pycache__ -exec rm -rf {} +
```

### Anti-Patterns to Avoid

- **Using `pip install` inside the project:** Always use `uv add` and `uv sync`. The uv.lock file must be the source of truth for dependencies.
- **Creating .ruff.toml or mypy.ini files:** All config belongs in pyproject.toml. Separate files create confusion about which config is active.
- **Using `mirrors-mypy` pre-commit hook:** It runs in an isolated env without project deps. Use local hook with `uv run mypy` instead.
- **Flat layout for library code:** Always use src-layout. Flat layout causes import confusion during testing (tests import local source instead of installed package).
- **Adding all sub-packages upfront:** Only create the sub-packages needed for the current phase. Empty stub directories with just `__init__.py` are acceptable to show the intended structure, but don't fill them with code.

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Linting + formatting | Separate flake8 + isort + black setup | ruff (single tool) | One config, one tool, millisecond speed |
| Virtualenv management | venv + pip + pip-tools | uv sync | Automatic venv creation, lockfile, 10-100x faster |
| Import sorting | isort config | ruff `I` rule | Included in ruff, no extra dep |
| Python version management | pyenv + manual .python-version | uv (manages Python installs) | uv handles Python version downloading and selection |
| Git hook installation | Manual .git/hooks scripts | pre-commit framework | Reproducible, declarative, auto-updates |
| Build backend | setuptools + setup.py | uv_build (generated by uv init --lib) | Modern, minimal config, PEP 517 compliant |

**Key insight:** The 2026 Python tooling stack has consolidated dramatically. uv + ruff replace 5-6 tools. Fighting this consolidation by using older tools creates maintenance burden for no benefit.

## Common Pitfalls

### Pitfall 1: Package Name vs Module Name Confusion

**What goes wrong:** The pyproject.toml `name` field uses hyphens (`bbj-rag`) per PEP 503 normalization, but the importable module name uses underscores (`bbj_rag`). Developers get confused about which to use where.

**Why it happens:** uv normalizes package names to use hyphens in pyproject.toml. Python module names must use underscores.

**How to avoid:** Document this clearly. In pyproject.toml: `name = "bbj-rag"`. In Python imports: `from bbj_rag.parsers import ...`. The src directory is `src/bbj_rag/`.

**Warning signs:** Import errors after running `uv sync`; trying to `import bbj-rag` (invalid Python).

### Pitfall 2: Forgetting to Commit uv.lock

**What goes wrong:** The uv.lock file is not committed, so other developers get different dependency versions.

**Why it happens:** Developers unfamiliar with uv assume .lock files are generated artifacts (like node_modules).

**How to avoid:** uv.lock MUST be committed to git. Add a note in the sub-project README. The .gitignore should NOT include uv.lock.

**Warning signs:** Different test results on different machines; "works on my machine" issues.

### Pitfall 3: Pre-commit mypy Hook Missing Dependencies

**What goes wrong:** Using `mirrors-mypy` pre-commit hook causes mypy to report false import errors because it runs in an isolated virtualenv without project dependencies.

**Why it happens:** Pre-commit creates isolated environments per hook. mypy needs the actual project dependencies to check types correctly.

**How to avoid:** Use a local hook with `language: system` and `entry: uv run mypy src/`. This runs mypy inside the project's uv-managed virtualenv.

**Warning signs:** mypy pre-commit hook reports "Cannot find module" for all third-party imports.

### Pitfall 4: Running uv Commands from Repo Root Instead of rag-ingestion/

**What goes wrong:** Running `uv sync` or `uv run` from the repo root fails because there's no pyproject.toml at the root (the root is a Docusaurus project).

**Why it happens:** Developers forget they need to `cd rag-ingestion/` first.

**How to avoid:** Document in both the repo README and the Makefile. The Makefile lives inside `rag-ingestion/` so `make test` etc. must be run from there. Consider adding a top-level Makefile that delegates: `cd rag-ingestion && make test`.

**Warning signs:** "No pyproject.toml found" errors.

### Pitfall 5: .gitignore Conflicts Between Node.js and Python

**What goes wrong:** The repo root .gitignore is tailored for Node.js (Docusaurus). Python artifacts like `__pycache__/`, `.mypy_cache/`, `.ruff_cache/` need their own ignore rules.

**Why it happens:** Mono-repo with two different tech stacks.

**How to avoid:** Add a `rag-ingestion/.gitignore` specific to Python, OR add Python-specific patterns to the root `.gitignore`. The uv-created `.venv/` already has its own internal `.gitignore` so it's auto-excluded.

**Warning signs:** Python cache files showing up in `git status`.

### Pitfall 6: Pre-commit Hooks and Mono-repo Root

**What goes wrong:** `.pre-commit-config.yaml` must be at the git repo root (not inside `rag-ingestion/`), because pre-commit hooks are git hooks that trigger from the repo root.

**Why it happens:** Pre-commit is a git-level tool, not a project-level tool.

**How to avoid:** Place `.pre-commit-config.yaml` at the repo root. Configure hooks to only target Python files in `rag-ingestion/`. Use the `files` key in hook config to scope hooks: `files: ^rag-ingestion/`.

**Warning signs:** `pre-commit install` from `rag-ingestion/` tries to install hooks but .git is in the parent directory.

## Code Examples

### Complete pyproject.toml (after scaffolding + configuration)

```toml
# Source: uv init --lib generates base, then manual additions
[project]
name = "bbj-rag"
version = "0.1.0"
description = "RAG ingestion pipeline for BBj documentation"
readme = "README.md"
requires-python = ">=3.12"
dependencies = []

[build-system]
requires = ["uv_build>=0.9.28,<0.10.0"]
build-backend = "uv_build"

[dependency-groups]
dev = [
    "pytest>=9.0.2",
    "ruff>=0.14.14",
    "mypy>=1.19.1",
    "pre-commit>=4.3.0",
]

[tool.ruff]
target-version = "py312"
line-length = 88
src = ["src", "tests"]

[tool.ruff.lint]
select = ["E", "W", "F", "I", "B", "UP", "RUF"]
fixable = ["ALL"]

[tool.ruff.format]
quote-style = "double"
indent-style = "space"

[tool.mypy]
python_version = "3.12"
strict = true
warn_return_any = true
warn_unused_configs = true

[[tool.mypy.overrides]]
module = "tests.*"
disallow_untyped_defs = false

[tool.pytest.ini_options]
testpaths = ["tests"]
addopts = ["-ra", "-q"]
```

### Complete .pre-commit-config.yaml (at repo root)

```yaml
# Source: Astral ruff-pre-commit docs + mypy local hook pattern
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: trailing-whitespace
        files: ^rag-ingestion/
      - id: end-of-file-fixer
        files: ^rag-ingestion/
      - id: check-yaml
        files: ^rag-ingestion/

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.14
    hooks:
      - id: ruff-check
        args: [--fix]
        files: ^rag-ingestion/
      - id: ruff-format
        files: ^rag-ingestion/

  - repo: local
    hooks:
      - id: mypy
        name: mypy
        entry: bash -c 'cd rag-ingestion && uv run mypy src/'
        language: system
        types: [python]
        files: ^rag-ingestion/
        pass_filenames: false
```

### Minimal __init__.py for Package Root

```python
"""BBj RAG ingestion pipeline."""

__version__ = "0.1.0"
```

### Placeholder Test

```python
"""Verify package is importable and pytest works."""

from bbj_rag import __version__


def test_version() -> None:
    assert __version__ == "0.1.0"
```

### Complete Makefile

```makefile
.DEFAULT_GOAL := help

.PHONY: help sync test lint format typecheck check clean

help:  ## Show this help message
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | \
		awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-15s\033[0m %s\n", $$1, $$2}'

sync:  ## Install all dependencies
	uv sync

test:  ## Run tests
	uv run pytest

lint:  ## Run linter (ruff check)
	uv run ruff check src/ tests/

format:  ## Format code (ruff format)
	uv run ruff format src/ tests/

typecheck:  ## Run type checker (mypy)
	uv run mypy src/

check: lint typecheck test  ## Run all checks (lint + typecheck + test)

clean:  ## Remove build/cache artifacts
	rm -rf .mypy_cache .ruff_cache .pytest_cache dist/
	find . -type d -name __pycache__ -exec rm -rf {} +
```

### Python .gitignore Additions

```gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.egg-info/
dist/
build/

# Type checking
.mypy_cache/

# Linting
.ruff_cache/

# Testing
.pytest_cache/
htmlcov/
.coverage

# Virtual environment (uv creates .venv with internal .gitignore, but belt-and-suspenders)
.venv/
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| pip + venv + pip-tools | uv (single tool) | 2024-2025 | 10-100x faster installs, unified workflow |
| flake8 + isort + black (3 tools) | ruff (1 tool) | 2023-2024 | Single config, millisecond speed |
| setup.py + setup.cfg | pyproject.toml (PEP 621) | 2022-2023 | Single config file for everything |
| requirements.txt | uv.lock (cross-platform lockfile) | 2024-2025 | Deterministic, platform-aware resolution |
| `[project.optional-dependencies] dev = [...]` | `[dependency-groups] dev = [...]` (PEP 735) | 2025 | Proper separation of dev vs runtime deps |
| Separate .flake8, mypy.ini, pytest.ini | All in pyproject.toml `[tool.*]` | 2022+ | One file to rule them all |

**Deprecated/outdated:**
- **setup.py / setup.cfg:** Replaced by pyproject.toml. Do not create these.
- **requirements.txt for dependency management:** uv.lock replaces this. requirements.txt can be exported from uv.lock if needed for deployment.
- **pipenv / poetry Pipfile:** uv replaces both tools. pyproject.toml + uv.lock is the current standard.

## Open Questions

1. **Sub-package stubs now or later?**
   - What we know: CONTEXT.md says "Sub-packages created as phases build them vs. full skeleton upfront: Claude's discretion"
   - What's unclear: Whether to create `parsers/`, `models/`, `pipeline/` directories with `__init__.py` stubs now, or only when those phases begin
   - Recommendation: Create at least the top-level `__init__.py` files for `parsers/` and `models/` now (they're referenced in the package structure decision), but keep them empty. Leave `pipeline/` for Phase 12.

2. **Pre-commit config location in mono-repo**
   - What we know: `.pre-commit-config.yaml` must be at the git repo root (where .git is). The Python project is in a subdirectory.
   - What's unclear: Whether the existing repo has any pre-commit config already
   - Recommendation: Place at repo root, scope all hooks with `files: ^rag-ingestion/`. The mypy hook needs `cd rag-ingestion && uv run mypy src/` as entry.

3. **CLI entry point now or deferred?**
   - What we know: CONTEXT.md lists this as Claude's discretion
   - Recommendation: Defer to Phase 12 (pipeline). A CLI entry point with no pipeline to run is dead code.

## Sources

### Primary (HIGH confidence)
- uv official docs (docs.astral.sh/uv/) - project init, dependencies, configuration, pre-commit integration
- ruff official docs (docs.astral.sh/ruff/) - configuration, pre-commit integration
- mypy official docs (mypy.readthedocs.io) - pyproject.toml configuration
- pytest official docs (docs.pytest.org) - pyproject.toml configuration
- pre-commit official docs (pre-commit.com) - hook configuration format

### Secondary (MEDIUM confidence)
- PyPI version pages for all tools (verified current versions as of 2026-01-31)
- GitHub issues for uv (name normalization behavior, mono-repo subdirectory handling)
- Community guides verified against official docs (src-layout best practices, mypy local hook pattern)

### Tertiary (LOW confidence)
- None. All findings verified against primary or secondary sources.

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH - All tools verified via official docs and PyPI with current versions
- Architecture: HIGH - Patterns verified in uv, ruff, mypy, pytest official documentation
- Pitfalls: HIGH - Identified from official docs, GitHub issues, and community guides; cross-verified

**Research date:** 2026-01-31
**Valid until:** 2026-03-01 (stable tools, 30-day validity; check uv version if major release occurs)
