---
phase: 19-final-consistency-pass
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Docusaurus build completes with zero broken links and zero warnings (Rspack deprecation notice excluded)"
    - "All 3 JSON tool schemas in Chapter 2 parse without error"
    - "All 13 Mermaid diagrams pass syntax validation via mmdc"
    - "All ~30 anchor-targeted cross-references resolve to headings that actually exist in the target page"
    - "BBj code validation gap is surfaced to user with concrete options"
  artifacts:
    - path: "(no files created -- read-only validation pass)"
      provides: "Verification that automated checks pass"
  key_links: []
---

<objective>
Run every machine-checkable validation across the documentation site: Docusaurus build (broken links, warnings), JSON schema syntax, Mermaid diagram syntax, cross-reference anchor resolution, and BBj code block inventory. Surface the bbjcpl availability gap for user decision.

Purpose: Establish a verified baseline before content-level fixes in Plans 02-03. If automated checks already pass, Plans 02-03 can focus purely on content consistency.
Output: Confirmed pass/fail for each automated validation category. BBj code validation gap flagged for user decision.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-final-consistency-pass/19-CONTEXT.md
@.planning/phases/19-final-consistency-pass/19-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run Docusaurus build + JSON + Mermaid + anchor validations</name>
  <files>(no files modified -- validation only)</files>
  <action>
Run four automated validations sequentially. For each, record pass/fail and any specific findings.

**1. Docusaurus build:**
```bash
cd /Users/beff/_workspace/bbj-ai-strategy && npm run build 2>&1
```
The build must complete with exit code 0. `onBrokenLinks: 'throw'` in docusaurus.config.ts means any broken link causes build failure. Ignore the Rspack `Module "node:assert"` deprecation notice -- that is a Docusaurus-internal tooling issue, not a content warning. Any OTHER warning or error is a real finding.

**2. JSON schema syntax validation:**
Extract the three JSON tool schemas from `docs/02-strategic-architecture/index.md` (they are in ```json code blocks within the MCP Server section). For each schema, run:
```bash
node -e "JSON.parse(\`<paste schema here>\`); console.log('Valid')"
```
All three must parse without error: `search_bbj_knowledge`, `generate_bbj_code`, `validate_bbj_syntax`.

**3. Mermaid diagram syntax validation:**
Extract all Mermaid diagram blocks from all doc files. For each diagram, write it to a temp file and validate:
```bash
cat > /tmp/mermaid-test.mmd << 'MERMAID_EOF'
<paste diagram>
MERMAID_EOF
npx @mermaid-js/mermaid-cli@latest mmdc -i /tmp/mermaid-test.mmd -o /tmp/mermaid-test.svg 2>&1
echo "Exit code: $?"
```
All 13 diagrams must produce exit code 0. Note: mmdc may print Puppeteer info messages -- only non-zero exit codes or "Error" lines are failures.

**4. Cross-reference anchor verification:**
Search all doc files for links containing `#` anchors (pattern: `](/docs/...#anchor-slug)`). For each anchor link:
- Identify the target file
- Identify the target heading (convert slug back to heading text using github-slugger conventions)
- Verify the heading exists in the target file by searching for it

Use this approach to verify anchors resolve:
```bash
node -e "
const GithubSlugger = require('./node_modules/github-slugger');
const s = new (GithubSlugger.default || GithubSlugger)();
console.log(s.slug('Your Heading Text Here'));
"
```

Record any anchors that do NOT resolve to an actual heading.

If ANY validation fails, document the specific failure (file, line, error message) as a finding. Do NOT fix doc content in this task -- just record findings. If anchors or build issues are found, they will be addressed in a later task or plan.
  </action>
  <verify>
All four validations have been run and results recorded:
1. `npm run build` exit code is 0
2. All 3 JSON schemas parse successfully
3. All 13 Mermaid diagrams produce exit code 0
4. All anchor-targeted cross-references resolve to existing headings
  </verify>
  <done>Every automated validation category has a clear pass/fail result. Any failures are documented with file, line, and error details.</done>
</task>

<task type="checkpoint:decision" gate="blocking">
  <decision>BBj code validation approach -- bbjcpl is not installed on this machine</decision>
  <context>
The phase decisions state "all BBj code must pass `bbjcpl -N`" and "if it's in the docs, it compiles." However, the BBj compiler (bbjcpl) is not installed on the development machine. There are 18 BBj code blocks across the site (Ch1: 13, Ch3: 1, Ch4: 2, Ch5: 2). Task 1 inventoried them but could not validate syntax.

This checkpoint presents options for how to handle BBj code validation before marking QUAL-01 as satisfied.
  </context>
  <options>
    <option id="option-a">
      <name>User validates BBj code manually</name>
      <pros>Definitive validation using authoritative compiler; no tooling changes needed</pros>
      <cons>Manual effort; user must have access to a BBj environment</cons>
    </option>
    <option id="option-b">
      <name>Accept expert review as proxy for bbjcpl</name>
      <pros>Claude can review all 18 blocks against BBj syntax rules in the bbj-reference.md and GuideToGuiProgrammingInBBj.pdf; catches obvious hallucinations; no compiler install needed</pros>
      <cons>Not ground-truth validation; may miss subtle semantic errors</cons>
    </option>
    <option id="option-c">
      <name>Install BBj on dev machine and run bbjcpl -N</name>
      <pros>True compiler validation as specified in requirements</pros>
      <cons>Requires BBj installation; may need BASIS license or access</cons>
    </option>
    <option id="option-d">
      <name>Defer QUAL-01 -- mark as known gap and ship</name>
      <pros>Does not block Phase 19 completion; can be addressed when bbjcpl is available</pros>
      <cons>Ships without the validation the site itself advocates</cons>
    </option>
  </options>
  <resume-signal>Select: option-a, option-b, option-c, or option-d</resume-signal>
</task>

</tasks>

<verification>
After Task 1 completes:
- All four automated validations have clear pass/fail results
- Any failures are documented with actionable detail (file, line, error)
- BBj code validation gap is presented to user with options

After checkpoint resolves:
- User has made a decision on BBj code validation approach
- The chosen approach can be executed in a subsequent plan if needed
</verification>

<success_criteria>
- Docusaurus build passes with zero warnings (excluding Rspack deprecation)
- All JSON schemas are valid
- All Mermaid diagrams are valid
- All cross-reference anchors resolve
- BBj code validation approach decided by user
</success_criteria>

<output>
After completion, create `.planning/phases/19-final-consistency-pass/19-01-SUMMARY.md`
</output>
