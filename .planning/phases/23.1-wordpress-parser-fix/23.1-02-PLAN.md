---
phase: 23.1-wordpress-parser-fix
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - rag-ingestion/README.md
autonomous: true

must_haves:
  truths:
    - "README documents Docker Compose setup from zero to running searches"
    - "Every CLI example has both local and Docker equivalents side-by-side"
    - "REST API endpoints (/search, /health, /stats) are documented with curl examples"
    - "MCP server setup for Claude Desktop is documented"
    - "bbj-ingest-all command is documented for both local and Docker contexts"
  artifacts:
    - path: "rag-ingestion/README.md"
      provides: "Complete usage documentation covering local CLI, Docker, REST API, and MCP server"
      contains: "docker compose"
  key_links:
    - from: "rag-ingestion/README.md"
      to: "docker-compose.yml"
      via: "Docker usage instructions reference compose services"
      pattern: "docker compose"
    - from: "rag-ingestion/README.md"
      to: "rag-ingestion/src/bbj_rag/mcp_server.py"
      via: "MCP setup instructions reference bbj-mcp entry point"
      pattern: "bbj-mcp"
---

<objective>
Update the rag-ingestion README with Docker Compose usage documentation, REST API endpoint reference, and MCP server setup instructions.

Purpose: The current README only covers local CLI usage with no mention of Docker, the REST API, or the MCP server. Someone going from zero needs to understand the Docker path (primary deployment) alongside the local path, know how to query the API, and set up Claude Desktop integration.

Output: A comprehensive README that documents the full parallel track -- local vs Docker side-by-side for every operation.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@rag-ingestion/README.md
@rag-ingestion/docker-compose.yml
@rag-ingestion/src/bbj_rag/mcp_server.py
@rag-ingestion/src/bbj_rag/api/routes.py
@rag-ingestion/src/bbj_rag/api/schemas.py
@rag-ingestion/src/bbj_rag/health.py
@rag-ingestion/src/bbj_rag/ingest_all.py
@rag-ingestion/sources.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Docker Usage section to README</name>
  <files>rag-ingestion/README.md</files>
  <action>
Add a new "## Docker Usage" section after the existing "## Usage" section. This section covers the Docker Compose deployment path as the primary way to run the full system.

Structure the section as follows:

### Quick Start
- `cp .env.example .env` and edit credentials
- Ensure Ollama is running on the host with `OLLAMA_HOST=0.0.0.0:11434`
- `docker compose up -d` to start pgvector and the app
- `docker compose logs -f` to watch startup

### Environment Variables (.env)
Reference the `.env.example` file. Key variables:
- `BBJ_RAG_DB_PASSWORD` (required, fail-fast)
- `BBJ_RAG_DB_USER`, `BBJ_RAG_DB_NAME` (defaults: bbj, bbj_rag)
- `DB_PORT_EXTERNAL` (default: 10432), `APP_PORT_EXTERNAL` (default: 10800)
- Source data path overrides (BBJDOCS_PATH, BBJ_AI_STRATEGY_PATH, etc.)

### Ingestion via Docker
Show Docker equivalents of the CLI commands:

**All sources:**
```bash
# Local
bbj-ingest-all --config sources.toml --data-dir /path/to/data

# Docker
docker compose exec app bbj-ingest-all --config sources.toml --clean
```

**Single source:**
```bash
# Local
bbj-rag ingest --source flare

# Docker
docker compose exec app bbj-rag ingest --source flare
```

**Full clean re-ingest:**
```bash
docker compose exec app bbj-ingest-all --config sources.toml --clean
```

Mention that Docker handles `DATA_DIR=/data` via the compose environment and source data is mounted as read-only volumes.
  </action>
  <verify>
The README contains a "Docker Usage" section with Quick Start, Environment Variables, and Ingestion subsections. Docker equivalents appear alongside local CLI examples.
  </verify>
  <done>
Docker Usage section added with Quick Start, .env reference, and ingestion commands (local vs Docker side-by-side).
  </done>
</task>

<task type="auto">
  <name>Task 2: Add REST API and MCP Server sections to README</name>
  <files>rag-ingestion/README.md</files>
  <action>
Add two new sections after "Docker Usage":

### REST API

Document the three endpoints with curl examples:

**POST /search** -- Hybrid search over the BBj documentation corpus.
```bash
curl -s http://localhost:10800/search \
  -H "Content-Type: application/json" \
  -d '{"query": "BBjGrid", "limit": 5}' | python -m json.tool
```

With generation filter:
```bash
curl -s http://localhost:10800/search \
  -H "Content-Type: application/json" \
  -d '{"query": "BBjGrid", "generation": "dwc", "limit": 5}'
```

Request body fields: `query` (required string), `generation` (optional: all, character, vpro5, bbj-gui, dwc), `limit` (optional int, default 10, max 50).

Response shape: `{"query": "...", "results": [...], "count": N}` where each result has `content`, `title`, `source_url`, `doc_type`, `generations`, `context_header`, `deprecated`, `score`.

**GET /health** -- Component health check (database + Ollama).
```bash
curl -s http://localhost:10800/health | python -m json.tool
```
Returns 200 when healthy, 503 when degraded or unhealthy. Response: `{"status": "healthy|degraded|unhealthy", "checks": {"database": "ok", "ollama": "ok"}}`.

**GET /stats** -- Corpus statistics.
```bash
curl -s http://localhost:10800/stats | python -m json.tool
```
Returns total chunk count, breakdown by doc_type and by generation tag.

### MCP Server (Claude Desktop)

Document the MCP server setup:

1. The MCP server runs on the **host** (not inside Docker) via stdio transport.
2. It proxies search requests to the REST API running in Docker.

**Prerequisites:** REST API must be running (`docker compose up -d`).

**Claude Desktop configuration** (`~/Library/Application Support/Claude/claude_desktop_config.json`):
```json
{
  "mcpServers": {
    "bbj-knowledge": {
      "command": "uv",
      "args": ["--directory", "/path/to/rag-ingestion", "run", "bbj-mcp"],
      "env": {
        "BBJ_RAG_API_URL": "http://localhost:10800"
      }
    }
  }
}
```

3. After configuring, restart Claude Desktop. The `search_bbj_knowledge` tool will appear in the tool list.
4. The tool accepts `query` (required), `generation` (optional), and `limit` (optional, default 5).
  </action>
  <verify>
README contains "REST API" and "MCP Server" sections. Curl examples for all three endpoints are present. Claude Desktop config JSON is shown.
  </verify>
  <done>
REST API section documents /search, /health, /stats with curl examples. MCP Server section documents Claude Desktop setup with config JSON. README is a complete guide from zero to running searches.
  </done>
</task>

</tasks>

<verification>
1. README contains "Docker Usage" section with Quick Start, .env reference, and ingestion commands
2. README contains "REST API" section with /search, /health, /stats curl examples
3. README contains "MCP Server" section with Claude Desktop configuration
4. Every CLI example has both local and Docker equivalents
5. No broken markdown formatting (headers, code blocks, tables)
</verification>

<success_criteria>
README documents the full path from zero to running searches: Docker setup, ingestion (local and Docker), REST API queries, and Claude Desktop MCP integration. A new user can follow the README to get the system running without external documentation.
</success_criteria>

<output>
After completion, create `.planning/phases/23.1-wordpress-parser-fix/23.1-02-SUMMARY.md`
</output>
