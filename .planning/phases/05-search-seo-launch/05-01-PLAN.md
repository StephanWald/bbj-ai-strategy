---
phase: 05-search-seo-launch
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docusaurus.config.ts
  - static/robots.txt
  - package.json
autonomous: true

must_haves:
  truths:
    - "A visitor can type a search term (e.g., 'LoRA', 'DWC') in the search bar and see relevant results from across all 7 chapters"
    - "The search index is built at production build time using @easyops-cn/docusaurus-search-local"
    - "Sharing the site URL on Slack, Twitter, or LinkedIn shows title, description, and og:type in the preview card"
    - "robots.txt exists at the site root and references the sitemap URL"
    - "The Docusaurus default social card image (dinosaur) is removed or replaced"
  artifacts:
    - path: "docusaurus.config.ts"
      provides: "Search theme config + SEO metadata"
      contains: "docusaurus-search-local"
    - path: "static/robots.txt"
      provides: "Search engine crawl rules"
      contains: "Sitemap:"
---

<objective>
Install local search plugin, configure Open Graph meta tags, and add robots.txt. After this plan, the site has working full-text search across all chapters and proper social sharing metadata.

Purpose: Search and SEO are the two active additions in Phase 5. Everything else (pagination, TOC, sitemap) already works out of the box.

Output: Working search bar with results, OG meta tags on every page, robots.txt with sitemap reference. Build passes with zero errors.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-search-seo-launch/05-RESEARCH.md
@docusaurus.config.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install search plugin and configure SEO</name>
  <files>docusaurus.config.ts, package.json, static/robots.txt</files>
  <action>
**Step 1: Install the search plugin**

```bash
cd /Users/beff/_workspace/bbj-ai-strategy
npm install --save @easyops-cn/docusaurus-search-local
```

**Step 2: Update docusaurus.config.ts**

Make these changes to the existing config:

**2a. Add search theme to the `themes` array:**

Change:
```typescript
themes: ['@docusaurus/theme-mermaid'],
```

To:
```typescript
themes: [
  '@docusaurus/theme-mermaid',
  [
    require.resolve("@easyops-cn/docusaurus-search-local"),
    /** @type {import("@easyops-cn/docusaurus-search-local").PluginOptions} */
    ({
      hashed: true,
      indexBlog: false,
      docsRouteBasePath: "/docs",
    }),
  ],
],
```

**2b. Add SEO metadata to `themeConfig`:**

Add these properties to the themeConfig object (at the top level, alongside `colorMode`, `navbar`, etc.):

```typescript
metadata: [
  { property: 'og:type', content: 'website' },
  { name: 'twitter:card', content: 'summary' },
],
```

Note: Use `summary` (not `summary_large_image`) for twitter:card since we are NOT providing a custom social card image. The `summary` card type shows title + description without requiring an image.

**2c. Remove the default social card image:**

Delete `static/img/docusaurus-social-card.jpg` -- the Docusaurus dinosaur should not appear when sharing. Do NOT set `themeConfig.image` since we're using text-only OG tags (title + description).

Also clean up unused Docusaurus placeholder images:
- Delete `static/img/docusaurus.png`
- Delete `static/img/undraw_docusaurus_mountain.svg`
- Delete `static/img/undraw_docusaurus_react.svg`
- Delete `static/img/undraw_docusaurus_tree.svg`

Keep `favicon.ico` and `logo.svg` (used by the site).

**Step 3: Create static/robots.txt**

Create the file `static/robots.txt` with this exact content:

```
User-agent: *
Allow: /

Sitemap: https://stephanwald.github.io/bbj-ai-strategy/sitemap.xml
```

**Step 4: Handle Rspack compatibility**

If `npm run build` fails with search plugin errors related to Rspack, change the `experimental_faster` config from boolean `true` to a granular object:

```typescript
future: {
  v4: true,
  experimental_faster: {
    swcJsLoader: true,
    swcJsMinimizer: true,
    swcHtmlMinimizer: true,
    lightningCssMinimizer: true,
    rspackBundler: false,
    mdxCrossCompilerCache: true,
  },
},
```

Only apply this fallback if the build fails. If the build passes with `experimental_faster: true`, leave it as-is.
  </action>
  <verify>
1. Build passes: `npm run build` completes with zero errors
2. Search plugin in config: `grep -c "docusaurus-search-local" docusaurus.config.ts` returns 1+
3. OG metadata in config: `grep -c "og:type" docusaurus.config.ts` returns 1
4. robots.txt exists: `test -f static/robots.txt && echo "exists"`
5. robots.txt has sitemap: `grep -c "Sitemap:" static/robots.txt` returns 1
6. Default social card removed: `test ! -f static/img/docusaurus-social-card.jpg && echo "removed"`
7. Search index generated: `test -d build/search-index* || ls build/ | grep -i search` (search artifacts exist in build output)
8. Verify search works: `npm run serve` and manually test search bar with Cmd+K (note: search only works in production build, not dev server)
  </verify>
  <done>
Search plugin installed and configured, OG meta tags added, robots.txt created, default Docusaurus social card removed. Build passes with zero errors and search index is generated at build time.
  </done>
</task>

</tasks>

<verification>
- `npm run build` passes with zero errors
- Search bar appears in navbar (visible in production build/serve)
- Searching for "LoRA" returns results from Chapter 3 (Fine-Tuning)
- Searching for "DWC" returns results from Chapter 1 (BBj Challenge)
- `view-source:` on built HTML shows og:type, og:title, og:description meta tags
- `static/robots.txt` references the sitemap URL
- No Docusaurus dinosaur images remain in static/img/
</verification>

<success_criteria>
The site has a working search bar that returns relevant results across all 7 chapters. Social sharing previews show the page title and description (text-only, no image). robots.txt is present and references the sitemap. The build passes with zero errors.
</success_criteria>

<output>
After completion, create `.planning/phases/05-search-seo-launch/05-01-SUMMARY.md`
</output>
