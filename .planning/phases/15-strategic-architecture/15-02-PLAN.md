---
phase: 15-strategic-architecture
plan: 02
type: execute
wave: 2
depends_on: ["15-01"]
files_modified:
  - docs/02-strategic-architecture/index.md
autonomous: true

must_haves:
  truths:
    - "Generate-validate-fix loop is described with a sequence diagram showing the compiler feedback cycle as a concrete, repeatable pattern"
    - "Three named integration patterns (Generate-Validate-Fix, Documentation Query, Code Review/Migration) are documented"
    - "Deployment options (local stdio, remote Streamable HTTP) are documented with privacy and team-sharing rationale"
    - "Current Status block reflects v1.2 RAG pipeline shipped and v1.3 MCP architecture defined"
    - "Three Initiatives section describes IDE/Chat/Future as MCP clients"
  artifacts:
    - path: "docs/02-strategic-architecture/index.md"
      provides: "Complete Chapter 2 update with all ARCH-01 through ARCH-10 requirements satisfied"
      contains: "generate-validate-fix"
  key_links:
    - from: "docs/02-strategic-architecture/index.md (Integration Patterns section)"
      to: "docs/02-strategic-architecture/index.md (MCP Server section from Plan 01)"
      via: "References tool names established in Plan 01"
      pattern: "search_bbj_knowledge|generate_bbj_code|validate_bbj_syntax"
---

<objective>
Add integration patterns, deployment options, and update existing sections (Three Initiatives, Benefits, Current Status) to complete the Chapter 2 MCP update.

Purpose: Complete the remaining ARCH requirements (05, 06, 08, 10) and update existing chapter sections to reflect MCP integration. After this plan, Chapter 2 is fully updated for Phase 15.

Output: Fully updated Chapter 2 with all 10 ARCH requirements satisfied. The file is a complete, publishable chapter.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/15-strategic-architecture/15-CONTEXT.md
@.planning/phases/15-strategic-architecture/15-RESEARCH.md
@.planning/phases/15-strategic-architecture/15-01-SUMMARY.md
@docs/02-strategic-architecture/index.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Integration Patterns and Deployment Options sections</name>
  <files>docs/02-strategic-architecture/index.md</files>
  <action>
Insert two new sections AFTER the MCP Server section (added by Plan 01) and BEFORE the "Three Initiatives" section.

**Section 1: Integration Patterns (ARCH-05, ARCH-08)**

```
## Integration Patterns
```

Introduce the section with 1-2 sentences: the MCP server enables several concrete integration patterns. Each pattern demonstrates a different way clients use the three tools.

**Pattern 1: Generate-Validate-Fix (ARCH-05, ARCH-08)**

This is the primary pattern and gets the most detail:

- `### Generate-Validate-Fix` heading
- 1 paragraph describing the pattern: client asks for code generation, validates with compiler, feeds errors back for correction. This is the key innovation — the BBj compiler provides ground-truth validation that eliminates hallucinated syntax. The loop continues until code compiles or a maximum iteration count is reached.
- Sequence diagram using Mermaid `sequenceDiagram` format. Use the diagram from 15-RESEARCH.md "Example 2: Generate-Validate-Fix Sequence Diagram" as the starting point. Participants: MCP Host (IDE/Chat), BBj MCP Server, RAG Database (pgvector), Fine-Tuned Model (Ollama), BBj Compiler (bbjcpl). Show the full flow: search -> generate -> validate -> (alt: errors -> regenerate -> revalidate).
- Follow existing Mermaid conventions: `participant Name as Display<br/>(detail)` format
- 1 sentence after the diagram noting this pattern was validated by the bbjcpltool proof-of-concept (reference only — no implementation details, no file paths, no hook scripts)

**Pattern 2: Documentation Query (ARCH-08)**

- `### Documentation Query` heading
- 1 paragraph: the simplest pattern — client sends a natural language question, server searches the RAG database with generation filtering, returns relevant documentation. No code generation or compilation involved. This is what the documentation chat system primarily uses.
- No diagram needed (the flow is straightforward: client -> search_bbj_knowledge -> results)

**Pattern 3: Code Review / Migration (ARCH-08)**

- `### Code Review and Migration` heading
- 1 paragraph: client submits existing code, server uses search_bbj_knowledge to find relevant migration documentation, generate_bbj_code to suggest modernized alternatives, and validate_bbj_syntax to confirm the suggestions compile. Useful for automated migration analysis of legacy BBj codebases.
- No diagram needed (it combines tools from the other two patterns)

**Section 2: Deployment Options (ARCH-06)**

```
## Deployment Options
```

- 1-2 sentence intro: the MCP server supports two deployment modes, matching different organizational needs.

**Local (stdio):**
- `### Local Deployment (stdio)` heading
- 1 paragraph: The MCP server runs as a local process on the developer's machine, communicating via stdio. All data stays local — model inference, RAG queries, and compiler validation happen on the same machine. This is the default for individual developers and organizations that require data privacy.

**Remote (Streamable HTTP):**
- `### Remote Deployment (Streamable HTTP)` heading
- 1 paragraph: For team environments, the MCP server can be deployed as a shared service accessible via Streamable HTTP. Multiple developers connect to the same server, sharing the fine-tuned model and RAG database. This follows the same pattern as the webforJ MCP server at mcp.webforj.com.
- Note: Streamable HTTP replaces the older HTTP+SSE transport in the current MCP specification (2025-11-25).

**Anti-patterns to avoid:**
- Do NOT turn Integration Patterns into an MCP protocol tutorial
- Do NOT add implementation details for deployment (no Docker configs, no systemd units)
- Do NOT speculate about bbjcpltool internals
- All technology references: Qwen2.5-Coder-7B via Ollama, pgvector, bbjcpl
  </action>
  <verify>
Run `cd /Users/beff/_workspace/bbj-ai-strategy && npx docusaurus build 2>&1 | tail -20` — build succeeds.
Grep checks:
1. `grep "## Integration Patterns" docs/02-strategic-architecture/index.md` — found
2. `grep "### Generate-Validate-Fix" docs/02-strategic-architecture/index.md` — found
3. `grep "### Documentation Query" docs/02-strategic-architecture/index.md` — found
4. `grep "### Code Review and Migration" docs/02-strategic-architecture/index.md` — found
5. `grep "## Deployment Options" docs/02-strategic-architecture/index.md` — found
6. `grep "sequenceDiagram" docs/02-strategic-architecture/index.md` — appears at least 2 times (original + new)
7. `grep "stdio" docs/02-strategic-architecture/index.md` — found
8. `grep "Streamable HTTP" docs/02-strategic-architecture/index.md` — found
  </verify>
  <done>Integration Patterns section contains three named patterns (Generate-Validate-Fix with sequence diagram, Documentation Query, Code Review and Migration). Deployment Options section documents local stdio and remote Streamable HTTP modes. All new sections maintain the professional peer voice and BBj-centric framing.</done>
</task>

<task type="auto">
  <name>Task 2: Update Three Initiatives, Benefits, and Current Status sections</name>
  <files>docs/02-strategic-architecture/index.md</files>
  <action>
Update three existing sections at the end of Chapter 2 to reflect MCP integration.

**1. Three Initiatives section updates:**

Update the introductory sentence to mention that the shared foundation is now accessed through the MCP server.

**VSCode Extension (Chapter 4):**
- Add 1-2 sentences noting that the extension acts as an MCP client, using `generate_bbj_code` for AI completions and `validate_bbj_syntax` for compiler validation. The Langium language server continues to provide deterministic completions; the MCP server handles the AI-powered generative layer.

**Documentation Chat (Chapter 5):**
- Add 1-2 sentences noting that the chat backend acts as an MCP client, primarily using `search_bbj_knowledge` for retrieval. Any MCP-compatible host (Claude, Cursor, etc.) can serve as a documentation chat interface with zero custom code.

**Future Capabilities:**
- Update the bullet list to frame future capabilities as MCP clients. The existing bullets (CLI assistant, Migration tooling, Code review, Training data feedback) stay. Add a framing sentence: because each capability is just another MCP client, adding new tools is primarily a UX problem.

**2. Benefits section updates:**

Add 1-2 MCP-specific benefit bullets to each stakeholder group. Keep the existing bullets — ADD to them, don't replace:

**For leadership:**
- Add: **Any-client compatibility** — the same MCP server works with Claude, VS Code, Cursor, or custom applications; no vendor lock-in

**For developers building with the infrastructure:**
- Add: **Standard tool protocol** — MCP provides schema-based tool discovery; new clients can integrate without reading implementation code

**For BBj developers using the tools:**
- Add: **Choose your client** — use the MCP server from whichever AI tool you prefer; the BBj intelligence is the same everywhere

**3. Current Status block update (ARCH-10):**

Replace the entire `:::note[Where Things Stand -- January 2026]` block and the status table with updated content:

Update the date to "February 2026" (or current month/year).

Updated status items:
- **Shipped:** bbj-language-server v0.5.0 on VS Code Marketplace (keep existing)
- **Shipped:** RAG ingestion pipeline (v1.2) — 6 source parsers, embedding pipeline, generation-aware tagging, hybrid search
- **Shipped:** bbjcpltool v1 proof-of-concept — validates compiler-in-the-loop concept for syntax checking
- **In progress:** Fine-tuned BBj model on Qwen2.5-Coder-7B (keep, update wording if needed)
- **In progress:** MCP server architecture defined (v1.3) — three tool schemas specified, generate-validate-fix loop validated
- **Planned:** MCP server implementation — concrete realization of the architecture documented in this chapter
- **Planned:** Documentation chat — depends on model and MCP server being operational

Updated status table:

| Component | Status | Next Steps |
|-----------|--------|------------|
| Fine-tuned BBj model | ~10K training examples curated; Qwen2.5-Coder-7B fine-tuning in progress | Expand dataset, establish evaluation benchmarks |
| RAG database | Ingestion pipeline shipped (v1.2). 6 source parsers, embedding pipeline, generation-aware tagging. | Index full BBj documentation corpus, tune retrieval quality |
| MCP server | Architecture defined (v1.3). Three tool schemas specified. | Implement server, integrate with RAG and model backends |
| BBj compiler validation | Concept validated by bbjcpltool v1 proof-of-concept | Integrate as validate_bbj_syntax MCP tool |
| VSCode extension | v0.5.0 shipped on Marketplace | Add MCP client integration for AI completions |
| Documentation chat | Architecture defined | Build as MCP client after server is operational |
| Ollama deployment | Validated for model serving | Package fine-tuned model, test customer self-hosting |

Keep the closing paragraph (line 214 in original) but update it if it references "the chapters that follow" in a way that needs adjustment. The existing closing paragraph is fine as-is since it just links to subsequent chapters.

**Anti-patterns to avoid:**
- Do NOT claim something is "not yet built" when v1.2 shipped it (RAG pipeline is shipped)
- Do NOT remove existing benefit bullets — only ADD MCP-specific ones
- Status table must be internally consistent with the status bullet points above it
  </action>
  <verify>
Run `cd /Users/beff/_workspace/bbj-ai-strategy && npx docusaurus build 2>&1 | tail -20` — build succeeds with zero errors and zero broken links.
Grep checks:
1. `grep "February 2026" docs/02-strategic-architecture/index.md` — found in status block
2. `grep "Ingestion pipeline shipped" docs/02-strategic-architecture/index.md` — found (RAG status updated)
3. `grep "bbjcpltool" docs/02-strategic-architecture/index.md` — found (proof-of-concept referenced)
4. `grep "MCP server" docs/02-strategic-architecture/index.md` — appears multiple times
5. `grep "MCP client" docs/02-strategic-architecture/index.md` — found in Three Initiatives section
6. Verify status table has 7 rows (Fine-tuned model, RAG database, MCP server, BBj compiler validation, VSCode extension, Documentation chat, Ollama deployment)
7. No broken internal links: all `/docs/...` links resolve
  </verify>
  <done>Three Initiatives describes IDE/Chat/Future as MCP clients. Benefits section includes MCP-specific advantages for each stakeholder group. Current Status block reflects v1.2 RAG shipped, bbjcpltool validated, and v1.3 MCP architecture in progress. Status table has 7 components with accurate statuses. Chapter 2 is fully updated — all 10 ARCH requirements satisfied.</done>
</task>

</tasks>

<verification>
After both tasks complete, verify ALL Phase 15 requirements:
1. ARCH-01: TL;DR mentions MCP server, three tools, generate-validate-fix (from Plan 01)
2. ARCH-02: MCP framed as concrete realization (from Plan 01)
3. ARCH-03: MCP topology diagram renders correctly (from Plan 01)
4. ARCH-04: Three tool definitions with JSON schemas (from Plan 01)
5. ARCH-05: Generate-validate-fix loop with sequence diagram (this plan, Task 1)
6. ARCH-06: Deployment options documented (this plan, Task 1)
7. ARCH-07: webforJ precedent referenced (from Plan 01)
8. ARCH-08: Three named integration patterns (this plan, Task 1)
9. ARCH-09: Decision callout with all four fields (from Plan 01)
10. ARCH-10: Current Status updated (this plan, Task 2)

Final build verification: `npx docusaurus build` completes with zero errors and zero warnings.
</verification>

<success_criteria>
- ARCH-05 satisfied: Generate-validate-fix loop with sequence diagram
- ARCH-06 satisfied: Local stdio and remote Streamable HTTP deployment options
- ARCH-08 satisfied: Three named integration patterns
- ARCH-10 satisfied: Current Status reflects v1.2 shipped + v1.3 in progress
- Three Initiatives and Benefits sections updated for MCP framing
- Chapter 2 reads as one cohesive narrative from TL;DR to closing paragraph
- Docusaurus build passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/15-strategic-architecture/15-02-SUMMARY.md`
</output>
