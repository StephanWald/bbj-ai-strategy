# Phase 01: Scaffold & Deploy Pipeline - Research

**Researched:** 2026-01-31
**Domain:** Docusaurus scaffold, configuration, GitHub Pages deployment
**Confidence:** HIGH

## Summary

This research supplements the existing project-level research (STACK.md, ARCHITECTURE.md) with implementation-specific details needed to plan the scaffold and deploy phase. The focus is on what the `create-docusaurus` scaffold actually generates, how to enable `@docusaurus/faster`, critical deployment gotchas, and the correct GitHub Actions versions to use.

Key discoveries: (1) The `--typescript` flag generates `.ts` config files and a `tsconfig.json` out of the box. (2) The template already includes `.nojekyll` in `static/` -- no manual creation needed. (3) `upload-pages-artifact@v3` safely includes `.nojekyll` in the tar archive, but v4 strips dotfiles with no workaround. (4) The current template includes `future: { v4: true }` by default, which pairs well with `@docusaurus/faster`. (5) GitHub Actions versions have advanced -- `actions/setup-node@v4` is the version Docusaurus docs currently recommend, but `@v6` is the latest available.

**Primary recommendation:** Use `npx create-docusaurus@latest bbj-ai-strategy classic --typescript`, install `@docusaurus/faster`, enable `future: { v4: true, experimental_faster: true }`, use `upload-pages-artifact@v3` (NOT v4), and Node.js 22 in GitHub Actions.

## Standard Stack

### Core

| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| create-docusaurus | 3.9.2 | Project scaffold | Official Docusaurus init tool |
| @docusaurus/faster | 3.9.2 | Rspack build pipeline | 2-4x faster builds, production-ready |
| Node.js | 22 LTS | Runtime | Docusaurus team uses Node 22 in CI since 3.8.1 |
| npm | (bundled) | Package manager | Simplest option, matches Docusaurus docs |

### GitHub Actions

| Action | Recommended Version | Purpose | Why This Version |
|--------|-------------------|---------|-----------------|
| actions/checkout | @v4 | Repo checkout | Matches Docusaurus official docs |
| actions/setup-node | @v4 | Node.js setup | Matches Docusaurus official docs; @v6 exists but is unnecessary |
| actions/upload-pages-artifact | **@v3** | Upload build output | v3 uses tar internally -- dotfiles like .nojekyll are preserved. **v4 strips dotfiles and has no workaround** |
| actions/deploy-pages | @v4 | Deploy to GitHub Pages | Latest, recommended by Docusaurus docs |

### Installation

```bash
npx create-docusaurus@latest bbj-ai-strategy classic --typescript
cd bbj-ai-strategy
npm install @docusaurus/faster
```

## Architecture Patterns

### What the Scaffold Generates

Running `npx create-docusaurus@latest bbj-ai-strategy classic --typescript` creates:

```
bbj-ai-strategy/
├── blog/                          # DELETE: sample blog posts (we disable blog)
│   ├── 2019-05-28-first-blog-post.md
│   ├── 2019-05-29-long-blog-post.md
│   ├── 2021-08-01-mdx-blog-post.mdx
│   ├── 2021-08-26-welcome/
│   ├── authors.yml
│   └── tags.yml
├── docs/                          # REPLACE: sample tutorial docs
│   ├── intro.md                   #   Replace with chapter structure
│   ├── tutorial-basics/           #   Delete entirely
│   └── tutorial-extras/           #   Delete entirely
├── src/
│   ├── components/                # EXISTS: may contain HomepageFeatures
│   ├── css/
│   │   └── custom.css             # MODIFY: keep file, content is fine as-is
│   └── pages/
│       ├── index.tsx              # MODIFY: replace with BBj AI Strategy landing
│       └── styles.module.css      # MODIFY: update styles for landing page
├── static/
│   ├── .nojekyll                  # KEEP: already included by template
│   └── img/                       # KEEP: default logos/favicons
├── docusaurus.config.ts           # MODIFY: site metadata, baseUrl, GitHub Pages
├── sidebars.ts                    # MODIFY: change sidebar name, keep autogenerated
├── tsconfig.json                  # KEEP: as-is
├── package.json                   # KEEP: modify scripts if needed
└── README.md                      # KEEP or replace
```

**Key insight for the planner:** The scaffold generates TypeScript files (`.ts`) when using `--typescript`. The config file is `docusaurus.config.ts` (not `.js`), and sidebar config is `sidebars.ts`. Both use ES module syntax with `import`/`export default`.

### Default Config File Template (key sections)

The generated `docusaurus.config.ts` includes:

```typescript
import type {Config} from '@docusaurus/types';
import type * as Preset from '@docusaurus/preset-classic';

const config: Config = {
  title: 'My Site',               // → Change to 'BBj AI Strategy'
  tagline: 'Dinosaurs are cool',  // → Change to tagline
  favicon: 'img/favicon.ico',
  url: 'https://your-docusaurus-site.example.com',  // → Change
  baseUrl: '/',                    // → Change to '/bbj-ai-strategy/'

  organizationName: 'facebook',    // → Change to 'beff'
  projectName: 'docusaurus',       // → Change to 'bbj-ai-strategy'

  onBrokenLinks: 'throw',
  onBrokenMarkdownLinks: 'warn',

  future: {
    v4: true,                      // ALREADY PRESENT in new templates
  },

  presets: [
    ['classic', {
      docs: { sidebarPath: './sidebars.ts' },
      blog: { /* ... */ },         // → Change to `blog: false`
      theme: { customCss: './src/css/custom.css' },
    }],
  ],

  themeConfig: {
    colorMode: { respectPrefersColorScheme: true },
    navbar: { /* default items */ },  // → Update items
    footer: { /* default links */ },  // → Update links
    prism: {
      theme: prismThemes.github,
      darkTheme: prismThemes.dracula,
    },
  },
};

export default config;
```

### Default Sidebars File

```typescript
import type {SidebarsConfig} from '@docusaurus/plugin-content-docs';

const sidebars: SidebarsConfig = {
  tutorialSidebar: [{type: 'autogenerated', dirName: '.'}],
  // → Rename 'tutorialSidebar' to 'strategySidebar'
};

export default sidebars;
```

### Modifications Needed (Scaffold → Project)

| File | Action | What Changes |
|------|--------|-------------|
| `docusaurus.config.ts` | MODIFY | title, tagline, url, baseUrl, organizationName, projectName, trailingSlash, future.experimental_faster, blog: false, navbar, footer |
| `sidebars.ts` | MODIFY | Rename sidebar key from `tutorialSidebar` to `strategySidebar` |
| `docs/` | REPLACE | Delete tutorial content, create 7 chapter folders with `_category_.json` + `index.md` |
| `blog/` | DELETE | Entire directory removed (blog: false in config) |
| `src/pages/index.tsx` | MODIFY | Replace default landing with BBj AI Strategy content |
| `src/pages/styles.module.css` | MODIFY | Update styles for new landing page |
| `package.json` | AUTOMATIC | Updated by `npm install @docusaurus/faster` |
| `static/.nojekyll` | KEEP | Already present, no action needed |

### Enabling @docusaurus/faster

After `npm install @docusaurus/faster`, add to `docusaurus.config.ts`:

```typescript
const config: Config = {
  // ...
  future: {
    v4: true,                    // Already in template
    experimental_faster: true,   // ADD THIS — enables all Rspack optimizations
  },
  // ...
};
```

Setting `experimental_faster: true` is a shorthand that enables ALL optimizations:
- `swcJsLoader` (SWC instead of Babel)
- `swcJsMinimizer` (SWC instead of Terser)
- `swcHtmlMinimizer` (SWC for HTML/CSS/JS minification)
- `lightningCssMinimizer` (Lightning CSS)
- `rspackBundler` (Rspack instead of webpack)
- `mdxCrossCompilerCache` (compile MDX once for both environments)

The granular object form exists for debugging:

```typescript
experimental_faster: {
  swcJsLoader: true,
  swcJsMinimizer: true,
  swcHtmlMinimizer: true,
  lightningCssMinimizer: true,
  rspackBundler: true,
  mdxCrossCompilerCache: true,
},
```

**Source:** [Docusaurus 3.6 release blog](https://docusaurus.io/blog/releases/3.6)

### Anti-Patterns to Avoid

- **Using `upload-pages-artifact@v4`:** v4 strips dotfiles including `.nojekyll`, breaking GitHub Pages. Use `@v3`.
- **Leaving `trailingSlash` as undefined:** GitHub Pages adds trailing slashes by default. Set it explicitly (`true` or `false`) to avoid 404s.
- **Using `docusaurus deploy` CLI:** Outdated approach requiring PATs and a gh-pages branch. Use GitHub Actions with `deploy-pages`.
- **Keeping the default blog content:** The template includes a `blog/` folder. Delete it and set `blog: false` in the config to avoid broken links.
- **Forgetting to update the sidebar key:** If navbar items reference `sidebarId: 'strategySidebar'` but `sidebars.ts` still uses `tutorialSidebar`, the build will fail.

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Chapter sidebar ordering | Manual sidebar entries per page | `_category_.json` + `type: 'autogenerated'` | Auto-discovery of new pages, less maintenance |
| GitHub Pages deployment | Custom deploy scripts | `actions/upload-pages-artifact@v3` + `actions/deploy-pages@v4` | OIDC auth, no tokens, battle-tested |
| Build speed optimization | Custom webpack config | `@docusaurus/faster` with `experimental_faster: true` | One config flag, maintained by Docusaurus team |
| `.nojekyll` creation | Build script that creates the file | Template already includes it in `static/` | Already present, just don't delete it |

**Key insight:** The scaffold generates nearly everything needed. The planner's job is to modify existing files, not create infrastructure from scratch.

## Common Pitfalls

### Pitfall 1: `upload-pages-artifact@v4` Strips `.nojekyll`

**What goes wrong:** Site deploys to GitHub Pages but CSS/JS/images are broken because files starting with `_` are processed by Jekyll.
**Why it happens:** `upload-pages-artifact@v4.0.0` (Aug 2024) excludes hidden files (dotfiles) from the artifact. `.nojekyll` is a dotfile. Unlike `upload-artifact@v4`, the pages-specific action has NO `include-hidden-files` option.
**How to avoid:** Use `actions/upload-pages-artifact@v3`. v3 creates a tar archive that includes dotfiles (only `.git` and `.github` are excluded), then uploads the tar as a single file.
**Warning signs:** Site deploys but shows raw HTML or missing styles. Check if `_` directories exist in the deployed output.
**Confidence:** HIGH (verified by reading the v3 and v4 action.yml source files on GitHub)

### Pitfall 2: `baseUrl` Mismatch

**What goes wrong:** Site loads at GitHub Pages URL but all assets (CSS, JS, images) return 404.
**Why it happens:** For project-level GitHub Pages (`beff.github.io/bbj-ai-strategy`), all assets must be served from the `/bbj-ai-strategy/` path prefix. If `baseUrl` is `/`, asset URLs point to the wrong root.
**How to avoid:** Set `baseUrl: '/bbj-ai-strategy/'` in `docusaurus.config.ts`. Verify locally with `npm run build && npm run serve -- --build --port 3000` and check that asset paths include the base.
**Warning signs:** Local dev works fine (localhost:3000) but deployed site is broken.
**Confidence:** HIGH

### Pitfall 3: `trailingSlash` Left as `undefined`

**What goes wrong:** Some pages return 404 on GitHub Pages, especially when navigating directly via URL.
**Why it happens:** GitHub Pages adds trailing slashes to URLs by default. If Docusaurus is not aware of this, generated links may not match what GitHub Pages expects.
**How to avoid:** Set `trailingSlash: false` explicitly in `docusaurus.config.ts`. This is the safer choice per ARCHITECTURE.md and the Docusaurus docs recommendation.
**Warning signs:** Intermittent 404s when refreshing pages or sharing direct URLs.
**Confidence:** HIGH

### Pitfall 4: Forgetting to Rename the Sidebar Key

**What goes wrong:** Build error or navbar links not connecting to sidebar.
**Why it happens:** Template generates `tutorialSidebar` as the key. If navbar items reference `strategySidebar` but the sidebar file still uses `tutorialSidebar`, Docusaurus throws an error.
**How to avoid:** Rename the key in `sidebars.ts` AND update all `sidebarId` references in `docusaurus.config.ts` navbar items at the same time.
**Warning signs:** Build error mentioning unresolved sidebar reference.
**Confidence:** HIGH

### Pitfall 5: Rspack Persistent Cache Stale Assets (CI/CD)

**What goes wrong:** Subsequent CI builds produce missing or broken CSS/JS assets.
**Why it happens:** Rspack's persistent cache had a bug (reported June 2025) where warm cache runs in new processes could produce incorrect assets. This was addressed in Rspack 1.3.15+.
**How to avoid:** Do NOT enable `rspackPersistentCache` in the GitHub Actions workflow. The `experimental_faster: true` shorthand does NOT include persistent cache. Only `rspackBundler` is enabled, which is safe. Persistent cache is an additional opt-in flag.
**Warning signs:** Intermittent broken builds in CI where the first build works but subsequent builds have missing assets.
**Confidence:** MEDIUM (bug was reported and fixes shipped, but worth noting for awareness)

### Pitfall 6: Sharp Module on macOS Tahoe (Dev Machine Only)

**What goes wrong:** `npm run start` fails with a missing Sharp module error on macOS 26.x (Tahoe).
**Why it happens:** `@docusaurus/lqip-loader` through `@rspack/core` depends on Sharp, which may fail to install on macOS Tahoe.
**How to avoid:** If hit, run `npm rebuild sharp` or install Sharp explicitly. This only affects local dev, not CI (which runs on Ubuntu).
**Warning signs:** Error mentioning `sharp` or `@docusaurus/lqip-loader` on `npm run start`.
**Confidence:** LOW (single report, may be environment-specific)

## Code Examples

### Complete `docusaurus.config.ts` for This Project

```typescript
// Source: Verified against Docusaurus 3.9.2 classic-typescript template + official docs
import {themes as prismThemes} from 'prism-react-renderer';
import type {Config} from '@docusaurus/types';
import type * as Preset from '@docusaurus/preset-classic';

const config: Config = {
  title: 'BBj AI Strategy',
  tagline: 'Intelligent Code Assistance Across Four Generations of Business BASIC',
  favicon: 'img/favicon.ico',

  url: 'https://beff.github.io',
  baseUrl: '/bbj-ai-strategy/',
  organizationName: 'beff',
  projectName: 'bbj-ai-strategy',
  trailingSlash: false,

  onBrokenLinks: 'throw',
  onBrokenMarkdownLinks: 'warn',

  future: {
    v4: true,
    experimental_faster: true,
  },

  i18n: {
    defaultLocale: 'en',
    locales: ['en'],
  },

  presets: [
    [
      'classic',
      {
        docs: {
          sidebarPath: './sidebars.ts',
        },
        blog: false,
        theme: {
          customCss: './src/css/custom.css',
        },
      } satisfies Preset.Options,
    ],
  ],

  themeConfig: {
    colorMode: {
      respectPrefersColorScheme: true,
    },
    navbar: {
      title: 'BBj AI Strategy',
      items: [
        {
          type: 'docSidebar',
          sidebarId: 'strategySidebar',
          position: 'left',
          label: 'Strategy',
        },
        {
          href: 'https://github.com/beff/bbj-ai-strategy',
          label: 'GitHub',
          position: 'right',
        },
      ],
    },
    footer: {
      style: 'dark',
      copyright: `Copyright ${new Date().getFullYear()} BASIS International Ltd.`,
    },
    prism: {
      theme: prismThemes.github,
      darkTheme: prismThemes.dracula,
    },
  } satisfies Preset.ThemeConfig,
};

export default config;
```

### Complete `sidebars.ts`

```typescript
// Source: Based on Docusaurus 3.9.2 classic-typescript template default
import type {SidebarsConfig} from '@docusaurus/plugin-content-docs';

const sidebars: SidebarsConfig = {
  strategySidebar: [{type: 'autogenerated', dirName: '.'}],
};

export default sidebars;
```

### Chapter `_category_.json` Template

```json
{
  "label": "The BBj Challenge",
  "position": 1,
  "link": {
    "type": "doc",
    "id": "01-bbj-challenge/index"
  }
}
```

### Complete `deploy.yml` Workflow

```yaml
# Source: Docusaurus official docs (deployment.mdx) with Node 22 update
name: Deploy to GitHub Pages

on:
  push:
    branches: [main]

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: npm
      - run: npm ci
      - run: npm run build
      - uses: actions/upload-pages-artifact@v3
        with:
          path: build

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - id: deployment
        uses: actions/deploy-pages@v4
```

### Complete `test-deploy.yml` Workflow

```yaml
name: Test deployment

on:
  pull_request:
    branches: [main]

jobs:
  test-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: npm
      - run: npm ci
      - run: npm run build
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| `docusaurus deploy` CLI + gh-pages branch | GitHub Actions with `deploy-pages@v4` | 2024-2025 | No PATs needed, OIDC auth, cleaner |
| Webpack bundler (default) | `@docusaurus/faster` with Rspack | Docusaurus 3.6.0 (Nov 2024) | 2-4x faster builds |
| `docusaurus.config.js` (JS only) | `.ts`, `.js`, `.mjs`, `.cjs` all supported | Docusaurus 3.x | TypeScript config with type checking |
| `upload-pages-artifact@v2` | `@v3` (NOT v4 for Docusaurus) | Dec 2023 | v3 preserves dotfiles via tar; v4 strips them |
| Node.js 18 in CI | Node.js 22 LTS | Docusaurus 3.8.1 (Jun 2025) | Better performance, current LTS |
| `actions/setup-node@v3` | `@v4` (or `@v6` latest) | 2024 | Improved caching |

**Deprecated/outdated:**
- `upload-pages-artifact@v4`: Strips dotfiles, breaks `.nojekyll`. Use `@v3` for Docusaurus.
- `docusaurus deploy` CLI: Replaced by GitHub Actions workflow. Still works but not recommended.
- Webpack as default bundler: Still the default, but `@docusaurus/faster` is production-ready and should be enabled for all new projects.

## Open Questions

1. **`actions/setup-node@v6` vs `@v4`**
   - What we know: v6 is the latest version on GitHub Marketplace. Docusaurus official docs still reference v4.
   - What's unclear: Whether v6 has any behavior changes that affect Docusaurus builds.
   - Recommendation: Use `@v4` to match Docusaurus docs. It works, it's tested, no need to go newer.

2. **`upload-pages-artifact` future versions**
   - What we know: v4 strips dotfiles with no `include-hidden-files` option. The v4 release notes say to create artifacts manually if dotfiles are needed.
   - What's unclear: Whether a v5 will restore dotfile support or add `include-hidden-files`.
   - Recommendation: Pin to `@v3` and add a comment in the workflow explaining why.

3. **Rspack persistent cache in CI**
   - What we know: The persistent cache bug was reported in June 2025 and fixes were shipped in Rspack 1.3.15. `experimental_faster: true` does NOT enable persistent cache.
   - What's unclear: Whether the fix fully resolved all edge cases.
   - Recommendation: Do not enable `rspackPersistentCache` in CI. The default `experimental_faster: true` is safe.

## Sources

### Primary (HIGH confidence)
- [Docusaurus installation docs](https://docusaurus.io/docs/installation) -- scaffold command, Node.js requirements
- [Docusaurus deployment docs](https://docusaurus.io/docs/deployment) -- GitHub Pages config, workflow YAML, `.nojekyll`
- [Docusaurus TypeScript support](https://docusaurus.io/docs/typescript-support) -- `--typescript` flag behavior
- [Docusaurus 3.6 release blog](https://docusaurus.io/blog/releases/3.6) -- `@docusaurus/faster` install and config
- [Docusaurus classic-typescript template on GitHub](https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/classic-typescript) -- exact generated files
- [Docusaurus shared template on GitHub](https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared) -- `.nojekyll` in static/, default docs/blog content
- [upload-pages-artifact v3 action.yml](https://github.com/actions/upload-pages-artifact/blob/v3/action.yml) -- tar-based archive preserves dotfiles
- [upload-pages-artifact v4.0.0 release](https://github.com/actions/upload-pages-artifact/releases/tag/v4.0.0) -- breaking change: dotfiles excluded
- [upload-pages-artifact main action.yml](https://github.com/actions/upload-pages-artifact/blob/main/action.yml) -- v4 has no `include-hidden-files` input
- [actions/setup-node](https://github.com/actions/setup-node) -- v4/v6 versions, Node.js version support

### Secondary (MEDIUM confidence)
- [Docusaurus Faster issue #10556](https://github.com/facebook/docusaurus/issues/10556) -- `future.v4` + `experimental_faster` recommended config
- [Docusaurus config API docs](https://docusaurus.io/docs/api/docusaurus-config) -- `future.v4` flag documentation
- [upload-artifact hidden files issue #602](https://github.com/actions/upload-artifact/issues/602) -- community discussion on dotfile exclusion impact

### Tertiary (LOW confidence)
- [Docusaurus issue #11644](https://github.com/facebook/docusaurus/issues/11644) -- Sharp module on macOS Tahoe (single report)
- [Rspack persistent cache issue #10599](https://github.com/web-infra-dev/rspack/issues/10599) -- cache bug (fix shipped but edge cases unclear)

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH -- verified against npm registry, official docs, and template source
- Architecture (scaffold output): HIGH -- verified by reading actual template files on GitHub
- Pitfalls: HIGH for deployment gotchas (verified source code), MEDIUM for Rspack edge cases
- Code examples: HIGH -- adapted from official docs and verified template defaults

**Research date:** 2026-01-31
**Valid until:** 2026-03-31 (stable stack, versions unlikely to change materially)
