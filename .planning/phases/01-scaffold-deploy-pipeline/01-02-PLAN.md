---
phase: 01-scaffold-deploy-pipeline
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - .github/workflows/deploy.yml
  - .github/workflows/test-deploy.yml
  - .gitignore
autonomous: false

must_haves:
  truths:
    - "Pushing to main triggers the GitHub Actions deploy workflow"
    - "The site is live at beff.github.io/bbj-ai-strategy within minutes of a push"
    - "The deployed site loads correctly (no broken CSS, JS, or images from baseUrl mismatch)"
    - "Pull requests trigger a test build workflow that catches build errors before merge"
  artifacts:
    - path: ".github/workflows/deploy.yml"
      provides: "GitHub Actions workflow for deploying to GitHub Pages"
      contains: "upload-pages-artifact@v3"
    - path: ".github/workflows/test-deploy.yml"
      provides: "GitHub Actions workflow for testing builds on PRs"
      contains: "npm run build"
    - path: ".gitignore"
      provides: "Git ignore rules for Docusaurus project"
      contains: "node_modules"
  key_links:
    - from: ".github/workflows/deploy.yml"
      to: "package.json"
      via: "npm ci and npm run build commands"
      pattern: "npm ci.*npm run build"
    - from: ".github/workflows/deploy.yml"
      to: "static/.nojekyll"
      via: "upload-pages-artifact@v3 preserves dotfiles in tar"
      pattern: "upload-pages-artifact@v3"
    - from: "docusaurus.config.ts"
      to: "deployed site URL"
      via: "baseUrl determines asset path prefix on GitHub Pages"
      pattern: "baseUrl.*bbj-ai-strategy"
---

<objective>
Create GitHub Actions workflows for deploying the Docusaurus site to GitHub Pages and verifying builds on pull requests. Then push to main and verify the site is live.

Purpose: Completes the deploy pipeline so every push to main automatically publishes the site. This is the "deploy" half of Phase 1's "Scaffold & Deploy Pipeline" — the site goes from localhost-only to publicly accessible.

Output: Two GitHub Actions workflows (deploy + test-deploy), a .gitignore for Docusaurus, and a verified live deployment at beff.github.io/bbj-ai-strategy.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-scaffold-deploy-pipeline/01-RESEARCH.md
@.planning/phases/01-scaffold-deploy-pipeline/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GitHub Actions workflows and .gitignore</name>
  <files>
    .github/workflows/deploy.yml
    .github/workflows/test-deploy.yml
    .gitignore
  </files>
  <action>
**Step 1: Create `.github/workflows/` directory.**

```bash
mkdir -p .github/workflows
```

**Step 2: Create `deploy.yml`.**

Use the EXACT workflow from `01-RESEARCH.md` "Complete deploy.yml Workflow" section:

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: [main]

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: npm
      - run: npm ci
      - run: npm run build
      - uses: actions/upload-pages-artifact@v3
        with:
          path: build

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - id: deployment
        uses: actions/deploy-pages@v4
```

CRITICAL: Use `actions/upload-pages-artifact@v3` (NOT v4). v4 strips dotfiles including `.nojekyll`, which breaks GitHub Pages serving of `_` prefixed directories. Add a comment in the YAML explaining this.

**Step 3: Create `test-deploy.yml`.**

Use the EXACT workflow from `01-RESEARCH.md` "Complete test-deploy.yml Workflow" section:

```yaml
name: Test deployment

on:
  pull_request:
    branches: [main]

jobs:
  test-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: npm
      - run: npm ci
      - run: npm run build
```

**Step 4: Create or update `.gitignore`.**

If Docusaurus scaffold created a `.gitignore`, verify it includes:
```
node_modules/
build/
.docusaurus/
.cache-loader/
```

If no `.gitignore` exists, create one with those entries. Also add:
```
npm-debug.log*
yarn-debug.log*
yarn-error.log*
```

Do NOT gitignore `.planning/` or `bbj-llm-strategy.md` — these belong in the repo.

**Step 5: Commit all project files and push to main.**

Stage all files (Docusaurus scaffold + docs + workflows + config). Commit with a clear message. Push to the `main` branch.

```bash
git add -A
git commit -m "feat: initialize Docusaurus site with chapter structure and deploy pipeline

- Docusaurus 3.9.2 with @docusaurus/faster (Rspack) for fast builds
- 7-chapter folder structure with placeholder content
- GitHub Actions workflow for GitHub Pages deployment
- baseUrl and trailingSlash configured for GitHub Pages"

git push origin main
```

NOTE: If this is the first push to GitHub, the remote may need to be set up. Use `git remote -v` to check. If no remote exists, the user will need to create the GitHub repo first. If the remote exists, just push.
  </action>
  <verify>
    Verify `.github/workflows/deploy.yml` exists and contains `upload-pages-artifact@v3` (NOT v4). Verify `.github/workflows/test-deploy.yml` exists. Verify `.gitignore` includes `node_modules/`, `build/`, `.docusaurus/`. Run `git status` to confirm all files are committed. Run `git push origin main` — if it succeeds, check the GitHub Actions tab for the deploy workflow running.
  </verify>
  <done>
    Both workflow files exist in `.github/workflows/`. The `.gitignore` correctly excludes build artifacts but not planning docs. All files are committed and pushed to main. The deploy workflow is triggered on GitHub.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Docusaurus site with 7-chapter structure, GitHub Pages deployment pipeline, and automated CI/CD. The site should be live at https://beff.github.io/bbj-ai-strategy/ after the GitHub Actions workflow completes.
  </what-built>
  <how-to-verify>
    1. Go to https://github.com/beff/bbj-ai-strategy/actions — verify the "Deploy to GitHub Pages" workflow ran successfully (green check)
    2. If the workflow failed:
       - Check the error logs in the Actions tab
       - Ensure GitHub Pages is enabled in repo Settings > Pages > Source: "GitHub Actions"
       - Re-run the workflow if it was a transient failure
    3. Visit https://beff.github.io/bbj-ai-strategy/ — verify:
       a. The landing page loads (not a 404)
       b. The page shows "BBj AI Strategy" title and tagline
       c. CSS and JS load correctly (site is styled, not raw HTML)
       d. Click "Read the Strategy" or navigate to the docs section
    4. In the docs section, verify:
       a. The left sidebar shows all 7 chapters in order
       b. Chapter labels are clean (e.g., "The BBj Challenge", not "01-bbj-challenge")
       c. Click each chapter — placeholder page loads with teaser text and "Coming Soon" note
    5. Check the browser URL — should be `beff.github.io/bbj-ai-strategy/docs/01-bbj-challenge` (no trailing slash, no 404)

    **If GitHub Pages is not enabled yet:**
    Go to repo Settings > Pages > Build and deployment > Source: select "GitHub Actions" (not "Deploy from a branch"). Then re-run the deploy workflow.
  </how-to-verify>
  <resume-signal>Type "approved" if the site is live and working, or describe any issues you see.</resume-signal>
</task>

</tasks>

<verification>
End-to-end verification of the deployed site:

1. GitHub Actions "Deploy to GitHub Pages" workflow completes successfully (green check)
2. https://beff.github.io/bbj-ai-strategy/ loads without errors
3. Landing page shows "BBj AI Strategy" with correct styling
4. All CSS/JS/images load (no 404s in browser dev tools network tab)
5. Sidebar shows 7 chapters in correct order with clean labels
6. Each chapter placeholder page is accessible and shows teaser content
7. URLs follow the pattern `/bbj-ai-strategy/docs/01-bbj-challenge` (correct baseUrl, no trailing slash)
8. The "Test deployment" workflow definition exists for PR builds
</verification>

<success_criteria>
- GitHub Actions deploy workflow triggers on push to main and succeeds
- Site is publicly accessible at beff.github.io/bbj-ai-strategy
- No broken CSS, JS, or images (baseUrl is correctly configured)
- All 7 chapters are navigable from the deployed site
- Test-deploy workflow exists for PR build verification
- The complete Phase 1 goal is achieved: "A working Docusaurus site with correct chapter structure deploys to GitHub Pages on every push to main"
</success_criteria>

<output>
After completion, create `.planning/phases/01-scaffold-deploy-pipeline/01-02-SUMMARY.md`
</output>
